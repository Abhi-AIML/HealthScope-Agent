{% extends "base.html" %}

{% block content %}
<div class="flex flex-col items-center justify-center h-[80vh] px-4 relative">
    
    <style>
        /* Forces the native calendar icon to be visible against a dark background */
        input[type="date"]::-webkit-calendar-picker-indicator {
            filter: invert(1);
            cursor: pointer;
        }
        /* Targets the text input value itself */
        input[type="date"] {
            color: #FAFAFA; /* Ensures text (date value) is white */
            background-color: #18181B; /* Matches input background */
            border-color: #27272A;
        }
        /* Fixes the SELECTED date background in the calendar popup */
        .ui-datepicker-current-day a {
            background: #00D290 !important; 
            color: black !important;
        }
    </style>
    <a href="/" class="absolute top-8 left-8 flex items-center text-gray-500 hover:text-white transition-colors text-sm font-mono">
        ‚Üê BACK TO HUB
    </a>

    <div class="max-w-lg w-full">
        <div class="mb-10">
            <h1 class="text-4xl font-black text-white mb-2 tracking-tighter">INITIALIZE DIAGNOSTICS</h1>
            <p class="text-gray-500 text-sm">Configure session parameters to begin agent analysis.</p>
        </div>
        
        <form id="upload-form" action="/analyze" method="post" enctype="multipart/form-data">
            
            <div class="mb-6">
                <label class="block text-[10px] font-bold text-zinc-500 uppercase tracking-widest mb-2">Sample Collection Date</label>
                <input type="date" name="report_date" value="{{ today }}" required
                       class="w-full bg-zinc-900 border border-zinc-700 text-white rounded-lg px-4 py-3 focus:outline-none focus:border-green-500 transition-colors font-mono text-sm">
            </div>

            <label class="group flex flex-col items-center justify-center w-full h-48 border-2 border-zinc-700 border-dashed rounded-xl cursor-pointer bg-zinc-900/50 hover:bg-zinc-900 hover:border-green-500 transition-all duration-300">
                <div class="flex flex-col items-center justify-center pt-5 pb-6">
                    <svg class="w-10 h-10 mb-3 text-zinc-500 group-hover:text-green-500 transition-colors" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"></path></svg>
                    <p class="text-sm text-gray-400 mb-1"><span class="font-bold text-white">Click to upload</span> PDF/JPG</p>
                </div>
                <input type="file" name="file" class="hidden" onchange="triggerUploadAndAnimate(this)" /> 
            </label>
            
            </form>
    </div>
</div>
<script>
    // Renamed and corrected the function to ensure the flow is clear
    function triggerUploadAndAnimate(input) {
        if (input.files && input.files[0]) {
            if (typeof runSequence === 'function') {
                runSequence();
            }
            
            // Wait briefly for the animation to start, then submit.
            setTimeout(() => {
                document.getElementById('upload-form').submit();
            }, 50); 
        }
    }
</script>
{% endblock %}